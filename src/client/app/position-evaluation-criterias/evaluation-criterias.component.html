<div>
  <div class="row datable-header">
    <div class="col-md-6 col-xs-12 datatable-header-add" *ngIf="!editing">
      <button type="button" pButton icon="fa-plus" (click)="editCriterias()"
              label="Editar criterios de evaluación"></button>
    </div>
    <div *ngIf="editing">
      <div class="container">
        <h3>Editando criterios de evaluación</h3>
        <p>La suma de factores para todos los críterios debe ser 100 para poder guardar</p>
      </div>
      <form (ngSubmit)="d.valid && oneHundred && !criteriaRepeated && savePositionCriterias()" #d="ngForm" novalidate id="criteriasForm">
        <div class="container">
          <div class="row"  *ngFor="let criteria of backUpPositionCriterias; let i = index">
            <div class="col-md-2 col-xs-12">
              <label for="evaluationCriteria{{i}}">* Criterio evaluacion</label>
              <p-dropdown id="evaluationCriteria{{i}}" name="evaluationCriteria{{i}}"
                          [options]="evaluationCriterias" required #criterio="ngModel"  (onChange)="checkRepeated()"
                          [autoWidth]="false" [(ngModel)]="criteria.idCriterio"></p-dropdown>
              <div class="ui-message ui-messages-error ui-corner-all" *ngIf="d.submitted && !criterio.valid" >
                <i class="fa fa-close"></i>
                Criterio es requerido
              </div>
            </div>
            <div class="col-md-3 col-xs-12">
              <label for="descripcion{{i}}">Descripción</label>
              <textarea id="descripcion{{i}}" name="descripcion{{i}}" pInputTextarea  rows="2" cols="35" #descripcion="ngModel"
                        [(ngModel)]="criteria.descripcion" required></textarea>
              <div class="ui-message ui-messages-error ui-corner-all" *ngIf="d.submitted && !descripcion.valid">
                <i class="fa fa-close"></i>
                Descripción es requerida
              </div>
            </div>
            <div class="col-md-3 col-xs-12">
              <label for="factor{{i}}">* Factor</label>
              <input type="number" maxlength="3" size="3" pattern="(?:\b|-)([1-9]{1,2}[0]?|100)\b" min="1" max="100" (change)="sumFactors()"
                     pInputText id="factor{{i}}" name="factor{{i}}" [(ngModel)]="criteria.factor" #factor="ngModel" required/>
              <div class="ui-message ui-messages-error ui-corner-all" *ngIf="d.submitted && !factor.valid">
                <i class="fa fa-close"></i>
                Factor es invalido
              </div>
            </div>
            <div class="col-md-3 col-xs-12">
              <label for="meta{{i}}">* Meta</label>
              <input type="number" pInputText id="meta{{i}}" name="meta{{i}}" [(ngModel)]="criteria.meta" #meta="ngModel" required/>
              <div class="ui-message ui-messages-error ui-corner-all" *ngIf="d.submitted && !meta.valid">
                <i class="fa fa-close"></i>
                Meta es requerido
              </div>
            </div>
            <div class="col-md-1 col-xs-12">
              <button *ngIf="i == 0" pButton type="button" (click)="addCriteria()" label="+"></button>
              <button *ngIf="i != 0" class="ui-button ui-button-danger btn" icon="fa-trash" pButton type="button"
                      (click)="removeCriteria(i)"></button>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 col-xs-12">
              <div class="alert alert-success" [hidden]="!oneHundred" role="alert">La suma es 100, perfecto!</div>
              <div class="alert alert-warning" [hidden]="(!d.submitted && !oneHundred) || (oneHundred)" role="alert">Lo siento, debe sumar 100</div>
              <div class="alert alert-warning" [hidden]="(!d.submitted && !criteriaRepeated)" role="alert">No puede tener criterios repetidos</div>
            </div>
            <div class="col-md-1 col-xs-12">
              {{total}}%
            </div>

          </div>
          <div class="row">
            <div class="col-md-4 col-xs-1">
            </div>
            <div class="col-md-1 col-xs-1">
              <a (click)="goBack()" class="cancelar">Cancelar</a>
            </div>
            <div class="col-md-2 col-xs-1">
              <button class="ui-button ui-button-success btn" icon="fa-plus" pButton icon="fa-plus" type="submit"
                      label="Agregar"></button>
            </div>
            <div class="col-md-5 col-xs-1"></div>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div *ngIf="!editing">
    <p-dataTable emptyMessage="{{ 'MSG_NORECORDSFOUND' | translate }}" [value]="positionCriterias" [paginator]="true"
                 [rows]="10" [responsive]="true" [globalFilter]="gb">
      <p-column field="criterio" header="Criterio de desempeño" [sortable]="true"></p-column>
      <p-column field="descripcion" header="Descripción" [sortable]="true"></p-column>
      <p-column field="factor" header="Factor" [sortable]="true"></p-column>
      <p-column field="meta" header="Meta" [sortable]="true"></p-column>
    </p-dataTable>
  </div>
   <div class="row">
      <div class="col-md-10">
      </div>
      <div class="col-md-2">
      <button type="button" pButton icon="fa-left-arrow" (click)="next()"
              label="Siguiente"></button>
      </div>
   </div>
</div>
<p-confirmDialog width="400"></p-confirmDialog>
